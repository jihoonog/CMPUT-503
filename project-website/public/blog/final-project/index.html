<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Final Project | Piko</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="CMPUT-503 Final Project"><meta name=author content="Jihoon Og"><link rel=canonical href=https://quackquack.forkprocess.com/blog/final-project/><link rel=stylesheet href=https://quackquack.forkprocess.com/sass/main.min.css><link rel=stylesheet href=https://quackquack.forkprocess.com/sass/nav.min.css><link rel=stylesheet href=https://quackquack.forkprocess.com/plugins/css/pico.min.css><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://quackquack.forkprocess.com/uploads/zap.svg><link rel=icon type=image/png sizes=16x16 href=https://quackquack.forkprocess.com/uploads/zap.svg><link rel=icon type=image/png sizes=32x32 href=https://quackquack.forkprocess.com/uploads/zap.svg><link rel=apple-touch-icon href=https://quackquack.forkprocess.com/uploads/zap.svg><link rel=mask-icon href=https://quackquack.forkprocess.com/uploads/zap.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.92.2"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://quackquack.forkprocess.com/uploads/og.webp"><meta name=twitter:title content="Final Project"><meta name=twitter:description content="CMPUT-503 Final Project"><meta property="og:title" content="Final Project"><meta property="og:description" content="CMPUT-503 Final Project"><meta property="og:type" content="article"><meta property="og:url" content="https://quackquack.forkprocess.com/blog/final-project/"><meta property="og:image" content="https://quackquack.forkprocess.com/uploads/og.webp"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-04-14T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-14T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://quackquack.forkprocess.com/uploads/og.webp"><meta name=twitter:title content="Final Project"><meta name=twitter:description content="CMPUT-503 Final Project"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://quackquack.forkprocess.com/blog/"},{"@type":"ListItem","position":2,"name":"Final Project","item":"https://quackquack.forkprocess.com/blog/final-project/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Final Project","name":"Final Project","description":"CMPUT-503 Final Project","keywords":["driving test","programming","ROS","Vehicle following","image recognition","apriltag"],"articleBody":"Team Members  Jihoon Og Qianxi Li  Final Project In this final project, we needed to combine all the knowledge we learned from the previous 5 exercises together and finish 3 separate tasks using our Duckiebot.\nStage 1 We have a Duckietown like the one below, the first stage is to start at the start position, the Duckiebot should move autonomously and following the commands from the Apriltags in Duckietown. Each tag is assigned with one kind of traffic signal, like stop, turn, and go straight. The desired route for the Duckiebot is to follow the purple route on the diagram below.\nThe diagram below shows one of the route that the Duckiebot needs to take for stage 1. The other route is taking the outside lane of the loop.\n Stage 2 After stage 1 is finished, it will go straight until it see a pedestrian walk or a duck walk in this case and make a short stop, if there are ducks waddling through the duck walk it will stop until it has been cleared. Otherwise, it will continue ahead. It then makes a turn, and the Duckiebot should stop, then move around the broken Duckiebot on the road and avoid run into it. It then needs to successfully handle a second duck walk following the same rules as the first one.\nThe diagram below shows what the Duckiebot needs to do to complete stage 2.\n Stage 3 The last stage is to park the Duckiebot into one of the 4 stalls. Which stall to park into is determined during the start of the demo.\nThe diagram below shows the 4 different stalls and the path to park in them.\n Implementation strategies Here we briefly describe our implementation for the final project.\nDetection To make the Duckiebot see, we utilized multiple different techniques for detecting different kinds of objects. For this project, things that need to be detected include:\n White and yellow lanes on the road Red stop lines Apriltags Obstacle detection (like the broken Duckiebot, yellow rubber duck, blue lane for pedestrian crossing)  Broken Car As the Duckiebot move toward the broken Duckiebot on the road, it is able to see the circular grid pattern on the back of it. In this case, we use the template code from exercise 4, which is about detecting the Duckiebot from the camera. For distance calculation we used the laser range finder because it is more accurate in determining the distance.\nApril Tag This was prett straightforward, the Apriltag detector has been used in many tasks in the past several exercises. One special things here is that, we needed the pose for each detection so that we can keep the closest detection to the Duckiebot, otherwise it will give up multiple detection and multiple conflicting commands.\nYellow duck and blue lane for pedestrian crossing Instead of using machine learning techniques to do the duck detection, we just used a simple color masks to mask out everything that is not yellow. The high-level idea is: first, we detect the stop sign Apriltag, then we detect the blue pedestrian crossing using the color mask, since the blue is unique around the stop sign Apriltag we just need to know whether there’s something blue in the image and on the road. Next, for the duck detection, we just need to know whether there’s something yellow in the image and on the blue lane, so color masking was used to find the ducks. However, because the yellow colour of the duck is similar to the yellow color of the median, we added an area threshold to only detect yellow that is big enough to be rubber duck sized and not a yellow lane marking.\nParking For parking we store all the parking stalls in a list where the stall number corresponds to the index representing the Apriltag ID for the stall. Parking is initiated based on the successful detection of the Apriltag that at the entrance of the parking lot. After stopping at the entrance of the parking lot it then drives into the parking lot making a right or left turn based on the stall number then using the Apriltag pose in robot frame, drive into the stall using the lateral distance (y) and rotational offset on the z axis to make correctional movements using PID control drive into the stall. This works okay if the robot is not too far off center both lateral and rotationally. As we didn’t have much time to tune the PID control for driving into the parking stall correctly. Moreover, if the camera lost track of the Apriltag from either getting too close and going out of view or too far away then it will constantly generate the same control output as we didn’t implement a timeout mechanism.\nPID For PID control for lane following we used the same settings and mechanism as in exercise 3 as it worked very well. We tried to implement PID control for velocity and for parking but due to time limitations we couldn’t implement them well in time.\nVideo demo Below shows a video demo of our bot doing all three stages.\n  Repo Link Final project repository link\nReferences  https://docs.photonvision.org/en/latest/docs/getting-started/pipeline-tuning/apriltag-tuning.html https://docs.duckietown.com/daffy/ https://github.com/duckietown/lib-dt-apriltags  Work Division  Jihoon: PID control, use detection results and make the robot make the right decision (turn, go straight, stop, avoid duck and broken car) Qianxi: All the detection things. Detect Apriltag, red and blue lanes and rubber ducks. Almas: Parking  ","wordCount":"910","inLanguage":"en","datePublished":"2023-04-14T00:00:00Z","dateModified":"2023-04-14T00:00:00Z","author":{"@type":"Person","name":"Jihoon Og"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://quackquack.forkprocess.com/blog/final-project/"},"publisher":{"@type":"Organization","name":"Piko","logo":{"@type":"ImageObject","url":"https://quackquack.forkprocess.com/uploads/zap.svg"}}}</script></head><body><nav class=desktop><ul><li><a class=logo href=https://quackquack.forkprocess.com/ accesskey=h title="Welcome to my CMPUT-503 course project's website (Alt + h)"><img src=/uploads/zap.svg alt="Welcome to my CMPUT-503 course project's website" width=35 height=35></img><h3 style=margin-bottom:0><strong><em>CMPUT-503 Robotics Project</em></strong></h3></a></li><li class=toggle-container><input type=checkbox id=switch>
<label for=switch><i id=darkIcon data-feather=moon></i>
<i id=lightIcon data-feather=sun></i></label></li></ul><ul class=desktop-navigation><li><a href=/blog title=Blog><i data-feather=pen-tool></i>
<span>Blog</span></a></li><li><a href=/search title="Search (Alt + /)" accesskey=/><i data-feather=search></i>
<span>Search</span></a></li><li><a href=https://github.com/jihoonog/CMPUT-503 title=Github><i data-feather=github></i>
<span></span></a></li></ul><ul class=mobile-navigation><li><button id=menuOpen onclick=openMobile() aria-label="Menu closed">
<i data-feather=menu></i></button>
<button id=menuClose onclick=openMobile() aria-label="Menu opened">
<i data-feather=x></i></button></li></ul></nav><aside class=sidebar id=mobileNav style=display:none><nav><ul><li><a href=/blog title=Blog><span><i data-feather=pen-tool></i>
Blog</span></a></li><li><a href=/search title="Search (Alt + /)" accesskey=/><span><i data-feather=search></i>
Search</span></a></li><li><a href=https://github.com/jihoonog/CMPUT-503 title=Github><span><i data-feather=github></i></span></a></li></ul></nav></aside><main><div class=container><hgroup><h1>Final Project</h1><time datetime="2023-04-14 00:00:00 +0000 UTC">April 14, 2023</time>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Jihoon Og<p>CMPUT-503 Final Project</p></hgroup><a href=https://quackquack.forkprocess.com/tags/driving-test/><kbd>driving test</kbd></a>
<a href=https://quackquack.forkprocess.com/tags/programming/><kbd>programming</kbd></a>
<a href=https://quackquack.forkprocess.com/tags/ros/><kbd>ROS</kbd></a>
<a href=https://quackquack.forkprocess.com/tags/vehicle-following/><kbd>Vehicle following</kbd></a>
<a href=https://quackquack.forkprocess.com/tags/image-recognition/><kbd>image recognition</kbd></a>
<a href=https://quackquack.forkprocess.com/tags/apriltag/><kbd>apriltag</kbd></a><div class="grid grid-main"><div><article class=toc><div><details><summary accesskey=c title="(Alt + C)"><span>Table of Contents</span></summary><div><ul><ul><li><a href=#team-members aria-label="Team Members">Team Members</a></li></ul><li><a href=#final-project aria-label="Final Project">Final Project</a><ul><li><a href=#stage-1 aria-label="Stage 1">Stage 1</a></li><li><a href=#stage-2 aria-label="Stage 2">Stage 2</a></li><li><a href=#stage-3 aria-label="Stage 3">Stage 3</a></li></ul></li><li><a href=#implementation-strategies aria-label="Implementation strategies">Implementation strategies</a><ul><li><a href=#detection aria-label=Detection>Detection</a><ul><li><a href=#broken-car aria-label="Broken Car">Broken Car</a></li><li><a href=#april-tag aria-label="April Tag">April Tag</a></li><li><a href=#yellow-duck-and-blue-lane-for-pedestrian-crossing aria-label="Yellow duck and blue lane for pedestrian crossing">Yellow duck and blue lane for pedestrian crossing</a></li></ul></li><li><a href=#parking aria-label=Parking>Parking</a></li><li><a href=#pid aria-label=PID>PID</a></li><li><a href=#video-demo aria-label="Video demo">Video demo</a></li><li><a href=#repo-link aria-label="Repo Link">Repo Link</a></li><li><a href=#references aria-label=References>References</a></li><li><a href=#work-division aria-label="Work Division">Work Division</a></li></ul></li></ul></div></details></div></article><div class=post><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Final Project on twitter" href="https://twitter.com/intent/tweet/?text=Final%20Project&url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f&hashtags=drivingtest%2cprogramming%2cROS%2cVehiclefollowing%2cimagerecognition%2capriltag"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Final Project on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f&title=Final%20Project&summary=Final%20Project&source=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Final Project on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f&title=Final%20Project"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Final Project on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Final Project on whatsapp" href="https://api.whatsapp.com/send?text=Final%20Project%20-%20https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Final Project on telegram" href="https://telegram.me/share/url?text=Final%20Project&url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div><h2 id=team-members>Team Members<a class=anchor aria-hidden=true href=#team-members>#</a></h2><ul><li>Jihoon Og</li><li>Qianxi Li</li></ul><h1 id=final-project>Final Project<a class=anchor aria-hidden=true href=#final-project>#</a></h1><p>In this final project, we needed to combine all the knowledge we learned from the previous 5 exercises together and finish 3 separate tasks using our Duckiebot.</p><h2 id=stage-1>Stage 1<a class=anchor aria-hidden=true href=#stage-1>#</a></h2><p>We have a Duckietown like the one below, the first stage is to start at the start position, the Duckiebot should move autonomously and following the commands from the Apriltags in Duckietown. Each tag is assigned with one kind of traffic signal, like stop, turn, and go straight. The desired route for the Duckiebot is to follow the purple route on the diagram below.</p><p>The diagram below shows one of the route that the Duckiebot needs to take for stage 1. The other route is taking the outside lane of the loop.</p><p><img src=/uploads/stage_1.png alt="stage 1"></p><h2 id=stage-2>Stage 2<a class=anchor aria-hidden=true href=#stage-2>#</a></h2><p>After stage 1 is finished, it will go straight until it see a pedestrian walk or a duck walk in this case and make a short stop, if there are ducks waddling through the duck walk it will stop until it has been cleared. Otherwise, it will continue ahead. It then makes a turn, and the Duckiebot should stop, then move around the broken Duckiebot on the road and avoid run into it. It then needs to successfully handle a second duck walk following the same rules as the first one.</p><p>The diagram below shows what the Duckiebot needs to do to complete stage 2.</p><p><img src=/uploads/stage_2.png alt="stage 2"></p><h2 id=stage-3>Stage 3<a class=anchor aria-hidden=true href=#stage-3>#</a></h2><p>The last stage is to park the Duckiebot into one of the 4 stalls. Which stall to park into is determined during the start of the demo.</p><p>The diagram below shows the 4 different stalls and the path to park in them.</p><p><img src=/uploads/stage_3.png alt="stage 3"></p><h1 id=implementation-strategies>Implementation strategies<a class=anchor aria-hidden=true href=#implementation-strategies>#</a></h1><p>Here we briefly describe our implementation for the final project.</p><h2 id=detection>Detection<a class=anchor aria-hidden=true href=#detection>#</a></h2><p>To make the Duckiebot see, we utilized multiple different techniques for detecting different kinds of objects.
For this project, things that need to be detected include:</p><ul><li>White and yellow lanes on the road</li><li>Red stop lines</li><li>Apriltags</li><li>Obstacle detection (like the broken Duckiebot, yellow rubber duck, blue lane for pedestrian crossing)</li></ul><h3 id=broken-car>Broken Car<a class=anchor aria-hidden=true href=#broken-car>#</a></h3><p>As the Duckiebot move toward the broken Duckiebot on the road, it is able to see the circular grid pattern on the back of it. In this case, we use the template code from exercise 4, which is about detecting the Duckiebot from the camera. For distance calculation we used the laser range finder because it is more accurate in determining the distance.</p><h3 id=april-tag>April Tag<a class=anchor aria-hidden=true href=#april-tag>#</a></h3><p>This was prett straightforward, the Apriltag detector has been used in many tasks in the past several exercises. One special things here is that, we needed the pose for each detection so that we can keep the closest detection to the Duckiebot, otherwise it will give up multiple detection and multiple conflicting commands.</p><h3 id=yellow-duck-and-blue-lane-for-pedestrian-crossing>Yellow duck and blue lane for pedestrian crossing<a class=anchor aria-hidden=true href=#yellow-duck-and-blue-lane-for-pedestrian-crossing>#</a></h3><p>Instead of using machine learning techniques to do the duck detection, we just used a simple color masks to mask out everything that is not yellow. The high-level idea is: first, we detect the stop sign Apriltag, then we detect the blue pedestrian crossing using the color mask, since the blue is unique around the stop sign Apriltag we just need to know whether there&rsquo;s something blue in the image and on the road. Next, for the duck detection, we just need to know whether there&rsquo;s something yellow in the image and on the blue lane, so color masking was used to find the ducks. However, because the yellow colour of the duck is similar to the yellow color of the median, we added an area threshold to only detect yellow that is big enough to be rubber duck sized and not a yellow lane marking.</p><h2 id=parking>Parking<a class=anchor aria-hidden=true href=#parking>#</a></h2><p>For parking we store all the parking stalls in a list where the stall number corresponds to the index representing the Apriltag ID for the stall.
Parking is initiated based on the successful detection of the Apriltag that at the entrance of the parking lot.
After stopping at the entrance of the parking lot it then drives into the parking lot making a right or left turn based on the stall number then using the Apriltag pose in robot frame, drive into the stall using the lateral distance (y) and rotational offset on the z axis to make correctional movements using PID control drive into the stall. This works okay if the robot is not too far off center both lateral and rotationally. As we didn&rsquo;t have much time to tune the PID control for driving into the parking stall correctly. Moreover, if the camera lost track of the Apriltag from either getting too close and going out of view or too far away then it will constantly generate the same control output as we didn&rsquo;t implement a timeout mechanism.</p><h2 id=pid>PID<a class=anchor aria-hidden=true href=#pid>#</a></h2><p>For PID control for lane following we used the same settings and mechanism as in exercise 3 as it worked very well. We tried to implement PID control for velocity and for parking but due to time limitations we couldn&rsquo;t implement them well in time.</p><h2 id=video-demo>Video demo<a class=anchor aria-hidden=true href=#video-demo>#</a></h2><p>Below shows a video demo of our bot doing all three stages.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/MgHLmd6TGSw style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h2 id=repo-link>Repo Link<a class=anchor aria-hidden=true href=#repo-link>#</a></h2><p><a href=https://github.com/jihoonog/CMPUT-503-Final-Project target=_blank rel=noopener>Final project repository link</a></p><h2 id=references>References<a class=anchor aria-hidden=true href=#references>#</a></h2><ul><li><a href=https://docs.photonvision.org/en/latest/docs/getting-started/pipeline-tuning/apriltag-tuning.html target=_blank rel=noopener>https://docs.photonvision.org/en/latest/docs/getting-started/pipeline-tuning/apriltag-tuning.html</a></li><li><a href=https://docs.duckietown.com/daffy/ target=_blank rel=noopener>https://docs.duckietown.com/daffy/</a></li><li><a href=https://github.com/duckietown/lib-dt-apriltags target=_blank rel=noopener>https://github.com/duckietown/lib-dt-apriltags</a></li></ul><h2 id=work-division>Work Division<a class=anchor aria-hidden=true href=#work-division>#</a></h2><ul><li>Jihoon: PID control, use detection results and make the robot make the right decision (turn, go straight, stop, avoid duck and broken car)</li><li>Qianxi: All the detection things. Detect Apriltag, red and blue lanes and rubber ducks.</li><li>Almas: Parking</li></ul></div><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Final Project on twitter" href="https://twitter.com/intent/tweet/?text=Final%20Project&url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f&hashtags=drivingtest%2cprogramming%2cROS%2cVehiclefollowing%2cimagerecognition%2capriltag"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Final Project on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f&title=Final%20Project&summary=Final%20Project&source=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Final Project on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f&title=Final%20Project"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Final Project on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Final Project on whatsapp" href="https://api.whatsapp.com/send?text=Final%20Project%20-%20https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Final Project on telegram" href="https://telegram.me/share/url?text=Final%20Project&url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2ffinal-project%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></div></div></div></main><footer class=text-center><span>A template by <a href=https://www.heksagon.net title="Your most friendly developer">Heksagon</a> &copy; 2023 Piko</span><div><a href=https://quackquack.forkprocess.com/legal/privacy>Privacy Policy</a>
<span>&</span>
<a href=https://quackquack.forkprocess.com/legal/terms-and-conditions>Terms and Conditions</a></div></footer><article class=hidden id=cookie-banner><div><span>We use cookies to improve your experience on our site and to show you relevant advertising.</span></div><footer><a role=button id=consent-cookies>Close</a>
<a role=button class=secondary href=/legal/privacy/#cookies-and-web-beacons>Cookies Policy</a></footer></article><script async src=https://quackquack.forkprocess.com/js/cookie.min.js layout=container></script>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('kbd');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script><script src=https://quackquack.forkprocess.com/plugins/js/feather.min.js layout=container></script>
<script src=https://quackquack.forkprocess.com/js/script.min.js layout=container></script></body></html>