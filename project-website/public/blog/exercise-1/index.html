<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Exercise 1 | Piko</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="First Lab Assignment"><meta name=author content="Jihoon Og"><link rel=canonical href=https://quackquack.forkprocess.com/blog/exercise-1/><link rel=stylesheet href=https://quackquack.forkprocess.com/sass/main.min.css><link rel=stylesheet href=https://quackquack.forkprocess.com/sass/nav.min.css><link rel=stylesheet href=https://quackquack.forkprocess.com/plugins/css/pico.min.css><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://quackquack.forkprocess.com/uploads/zap.svg><link rel=icon type=image/png sizes=16x16 href=https://quackquack.forkprocess.com/uploads/zap.svg><link rel=icon type=image/png sizes=32x32 href=https://quackquack.forkprocess.com/uploads/zap.svg><link rel=apple-touch-icon href=https://quackquack.forkprocess.com/uploads/zap.svg><link rel=mask-icon href=https://quackquack.forkprocess.com/uploads/zap.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.92.2"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://quackquack.forkprocess.com/uploads/og.webp"><meta name=twitter:title content="Exercise 1"><meta name=twitter:description content="First Lab Assignment"><meta property="og:title" content="Exercise 1"><meta property="og:description" content="First Lab Assignment"><meta property="og:type" content="article"><meta property="og:url" content="https://quackquack.forkprocess.com/blog/exercise-1/"><meta property="og:image" content="https://quackquack.forkprocess.com/uploads/og.webp"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-01-20T19:24:50-07:00"><meta property="article:modified_time" content="2023-01-20T19:24:50-07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://quackquack.forkprocess.com/uploads/og.webp"><meta name=twitter:title content="Exercise 1"><meta name=twitter:description content="First Lab Assignment"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://quackquack.forkprocess.com/blog/"},{"@type":"ListItem","position":2,"name":"Exercise 1","item":"https://quackquack.forkprocess.com/blog/exercise-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Exercise 1","name":"Exercise 1","description":"First Lab Assignment","keywords":["bulding","programming","linux","docker"],"articleBody":"This is the first lab assignment of the course. Graduate students needed to build their Duckiebots as well as flash the SD card and demonstrate moving the robot in a straight line and show that it can stay within a lane using the built-in Duckiebot lane-following module.\nSetting up the website Setting up the website wasn’t too difficult as it was just following the instructions on GitHub Pages with Jekyll. Installing Jekyll wasn’t too bad on my system just needed to install Ruby and install the framework using Gem. Because I have my own domain forkprocess.com I wanted to use it to point it to my course website. I use subdomains to access external web services so I created a new subdomain quackquack that will point to project’s website that is being hosted on GitHub. For deployment I used GitHub Actions to build the content of the site and deploy it automatically once something has been committed to the main repo.\nAlso, after working with Jekyll for a little bit I decided to move to Hugo as it was a framework that I was much more familiar with and can generate a blog style site faster with more diversity of themes.\nAssembling the robot Assembling the robot wasn’t too bad except for inserting the metal nuts into the chassis. I had to file down the inserts a bit so it can accept the metal nuts more easily.\nOther then that I was able to assemble the robot in about 3 hours.\nFlashing the SD card Flashing the SD card wasn’t too bad it was just long. Running this command dts init_sd_card --hostname csc22935 --type duckiebot --configuration DB21M --wifi 'DuckieNet:CMPUT412_1234!!!Rox' --no-steps verify took a little over an hour to finish. I skipped the verification step because it takes a while to do and I felt confident that the sd card flashed properly.\nNote: I had to do this multiple times because I had issues getting my bot to move/boot. To improve the process I kept the compressed image file for the Nvidia Jetson Nano used in the Duckiebot within my home directory, and copy the file over to the tmp working space that the init_sd_card program used for downloading and unpacking the image file.\nDashboard After the first boot I was able to connect to my Duckiebot’s dashboard by loading it in my web browser by accessing csc22935.local or the hostname of my Duckiebot. After the initial setup I was able to see the motor commands and camera output on the dashboard as shown below.\n Getting the robot to move and debugging pain At first the robot didn’t move using dts duckiebot keyboard_control. I followed the debugging steps, checking to see if the duckiebot-interface is up and running. Then when that didn’t resolve the problem I updated the containers which lead to other issues due to what I initially thought my docker package being incompatible with this version of dts. So I uninstalled everything and reflashed the SD card again to double check nothing when wrong during installation, same issue. Then I tried to update the Duckiebot firmware by using dts duckiebot update which lead to another issue this time an 500 server error that I originally thought was caused by docker installation as well.\nWell after many hours spent debugging the issues, doing multiple SD card reflashes and software reinstallations, I found that the problems were not from a single core issue but from multiple, seemly independent sources, here is a list to keep things brief:\n 500 Server Error: Removed my DockerHub credentials from the dts config file as that was interfering with the login process that was giving the 500 server error. Never apt-get upgrade on the Duckiebot itself as it will brink the entire system, use the dts duckiebot upgrade command instead The HUT needed to be reflashed again as it was running the wrong version but was reporting the latest version on the dashboard, thus wasn’t a clue at first. If the WiFi disconnects it’s easier to remove the WiFi adapter and plug it back in as the hotplug parameter was set during initialization therefore it will try and reconnect once the adapter is reconnected into the USB port. Don’t let your battery get too low otherwise it will lead to unexpected behaviors like improper shutdowns and WiFi disconnections. Make sure that all your micro USB cables are connected properly so that it can power on properly and prevent unnecessary SD card reflashes.  Calibrating the motors Following the guide on calibrating the motors I drove the robot in a straight line to see the drift. It it drifted left then I would decrease the trim value and if it drifted right I would increase the trim value. The trim parameter is a ratio of how much one motor should move compare to the other. If trim  0 then the right motor will spin faster compared to the left and vice versa. The gain parameter is a scalar value applied to both motors on how much to spin based on the commanded signal. There is a careful balancing act between having enough gain that the robot will move when commanded at the lowest speed but lower enough that any errors aren’t amplified to be unpredictable. For both values I used binary search to find a good enough trim value such that the robot would travel straight with at most a 10 cm drift driving 2 meters. The values I settled on for trim = 0.0515 and gain = 0.85. The video below shows the straight line performance of the robot using these values.\n  Calibrating the camera Calibrating the camera was pretty easy. Following the instructions outlined in the Duckiebot documentation. I was able to calibrate both the intrinsic and extrinsic values of the robot by calling:\ndts duckiebot calibrate_intrinsics csc22935 and\ndts duckiebot calibrate_extrinsics csc22935 and follow the instructions outlined from the terminal.\nIntrinsic calibration takes into accound the small manufacturing discrepancies the lens and the sensor will have on an image. By moving the camera or bot back and forth, side to side, up and down, rotating off plane, etc I was able to get the calibration software to learn about these discrepances and make adjustments to the raw outputs so they accurately replicate reality. Extrinsic calibration tries to learn the camera’s location in 3-D space, how it’s positioned and how it’s rotated. This is important for trying to find the lane markings in Duckietown.\nLane following Running the lane following demo was fairly easy I made sure that both duckiebot-interface and car-interface was running and start the lane following container by running this command in dts:\ndts duckiebot demo --demo_name lane_following --duckiebot_name csc22935 --package_name duckietown_demos Once the container was running I opened the keyboard control for my bot and pressed the a key to start the lane following demo. The video below shows the lane following demo in action:\n  Note: I had to tune the parameters so that I can make the turns in duckietown. I had to increase the k_theta and k_d values a little bit so the robot can turn more aggressively and make the turns without going over the lines.\nColour Detection This was the most difficult part of the exercise, something I put way too much effort into when we are not going to use this code base for anything as we are going to use ROS to get the images from the camera node, but it was a good exercise nonetheless. I followed the instructions from the basic development guide from Duckietown and found that a lot of the documentation was outdated. Particularly the GStreamer pipeline code was not for the DB21 platform. I found the correct GStreamer pipeline code from the dt-duckiebot-interface repository and used that to open the camera. However, this still lead to an issue initialization the camera in OpenCV. I think the main issue is caused by missing runtime environments that GStreamer requires that isn’t being initialized by Dockerfile. I might be able to find the correct initialization procedure in the dt-duckiebot-interface repository but at this point I spent too much time trying to get this minor code to work. So I just ignored it for now.\n","wordCount":"1371","inLanguage":"en","datePublished":"2023-01-20T19:24:50-07:00","dateModified":"2023-01-20T19:24:50-07:00","author":{"@type":"Person","name":"Jihoon Og"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://quackquack.forkprocess.com/blog/exercise-1/"},"publisher":{"@type":"Organization","name":"Piko","logo":{"@type":"ImageObject","url":"https://quackquack.forkprocess.com/uploads/zap.svg"}}}</script></head><body><nav class=desktop><ul><li><a class=logo href=https://quackquack.forkprocess.com/ accesskey=h title="Welcome to my CMPUT-503 course project's website (Alt + h)"><img src=/uploads/zap.svg alt="Welcome to my CMPUT-503 course project's website" width=35 height=35></img><h3 style=margin-bottom:0><strong><em>CMPUT-503 Robotics Project</em></strong></h3></a></li><li class=toggle-container><input type=checkbox id=switch>
<label for=switch><i id=darkIcon data-feather=moon></i>
<i id=lightIcon data-feather=sun></i></label></li></ul><ul class=desktop-navigation><li><a href=/blog title=Blog><i data-feather=pen-tool></i>
<span>Blog</span></a></li><li><a href=/search title="Search (Alt + /)" accesskey=/><i data-feather=search></i>
<span>Search</span></a></li><li><a href=https://github.com/jihoonog/CMPUT-503 title=Github><i data-feather=github></i>
<span></span></a></li></ul><ul class=mobile-navigation><li><button id=menuOpen onclick=openMobile() aria-label="Menu closed">
<i data-feather=menu></i></button>
<button id=menuClose onclick=openMobile() aria-label="Menu opened">
<i data-feather=x></i></button></li></ul></nav><aside class=sidebar id=mobileNav style=display:none><nav><ul><li><a href=/blog title=Blog><span><i data-feather=pen-tool></i>
Blog</span></a></li><li><a href=/search title="Search (Alt + /)" accesskey=/><span><i data-feather=search></i>
Search</span></a></li><li><a href=https://github.com/jihoonog/CMPUT-503 title=Github><span><i data-feather=github></i></span></a></li></ul></nav></aside><main><div class=container><hgroup><h1>Exercise 1</h1><time datetime="2023-01-20 19:24:50 -0700 MST">January 20, 2023</time>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Jihoon Og<p>First Lab Assignment</p></hgroup><a href=https://quackquack.forkprocess.com/tags/bulding/><kbd>bulding</kbd></a>
<a href=https://quackquack.forkprocess.com/tags/programming/><kbd>programming</kbd></a>
<a href=https://quackquack.forkprocess.com/tags/linux/><kbd>linux</kbd></a>
<a href=https://quackquack.forkprocess.com/tags/docker/><kbd>docker</kbd></a><div class="grid grid-main"><div><article class=toc><div><details><summary accesskey=c title="(Alt + C)"><span>Table of Contents</span></summary><div><ul><li><a href=#setting-up-the-website aria-label="Setting up the website">Setting up the website</a></li><li><a href=#assembling-the-robot aria-label="Assembling the robot">Assembling the robot</a></li><li><a href=#flashing-the-sd-card aria-label="Flashing the SD card">Flashing the SD card</a></li><li><a href=#dashboard aria-label=Dashboard>Dashboard</a></li><li><a href=#getting-the-robot-to-move-and-debugging-pain aria-label="Getting the robot to move and debugging pain">Getting the robot to move and debugging pain</a></li><li><a href=#calibrating-the-motors aria-label="Calibrating the motors">Calibrating the motors</a></li><li><a href=#calibrating-the-camera aria-label="Calibrating the camera">Calibrating the camera</a></li><li><a href=#lane-following aria-label="Lane following">Lane following</a></li><li><a href=#colour-detection aria-label="Colour Detection">Colour Detection</a></li></ul></div></details></div></article><div class=post><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Exercise 1 on twitter" href="https://twitter.com/intent/tweet/?text=Exercise%201&url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f&hashtags=bulding%2cprogramming%2clinux%2cdocker"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Exercise 1 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f&title=Exercise%201&summary=Exercise%201&source=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Exercise 1 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f&title=Exercise%201"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Exercise 1 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Exercise 1 on whatsapp" href="https://api.whatsapp.com/send?text=Exercise%201%20-%20https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Exercise 1 on telegram" href="https://telegram.me/share/url?text=Exercise%201&url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div><p>This is the first lab assignment of the course. Graduate students needed to build their Duckiebots as well as flash the SD card and demonstrate moving the robot in a straight line and show that it can stay within a lane using the built-in Duckiebot lane-following module.</p><h2 id=setting-up-the-website>Setting up the website<a class=anchor aria-hidden=true href=#setting-up-the-website>#</a></h2><p>Setting up the website wasn&rsquo;t too difficult as it was just following the instructions on GitHub Pages with Jekyll.
Installing Jekyll wasn&rsquo;t too bad on my system just needed to install Ruby and install the framework using Gem.
Because I have my own domain <code>forkprocess.com</code> I wanted to use it to point it to my course website. I use subdomains to access external web services so I created a new subdomain <code>quackquack</code> that will point to project&rsquo;s website that is being hosted on GitHub. For deployment I used GitHub Actions to build the content of the site and deploy it automatically once something has been committed to the main repo.</p><p>Also, after working with Jekyll for a little bit I decided to move to Hugo as it was a framework that I was much more familiar with and can generate a blog style site faster with more diversity of themes.</p><h2 id=assembling-the-robot>Assembling the robot<a class=anchor aria-hidden=true href=#assembling-the-robot>#</a></h2><p>Assembling the robot wasn&rsquo;t too bad except for inserting the metal nuts into the chassis. I had to file down the inserts a bit so it can accept the metal nuts more easily.</p><p>Other then that I was able to assemble the robot in about 3 hours.</p><h2 id=flashing-the-sd-card>Flashing the SD card<a class=anchor aria-hidden=true href=#flashing-the-sd-card>#</a></h2><p>Flashing the SD card wasn&rsquo;t too bad it was just long. Running this command <code>dts init_sd_card --hostname csc22935 --type duckiebot --configuration DB21M --wifi 'DuckieNet:CMPUT412_1234!!!Rox' --no-steps verify</code> took a little over an hour to finish. I skipped the verification step because it takes a while to do and I felt confident that the sd card flashed properly.</p><p>Note: I had to do this multiple times because I had issues getting my bot to move/boot. To improve the process I kept the compressed image file for the Nvidia Jetson Nano used in the Duckiebot within my home directory, and copy the file over to the <code>tmp</code> working space that the <code>init_sd_card</code> program used for downloading and unpacking the image file.</p><h2 id=dashboard>Dashboard<a class=anchor aria-hidden=true href=#dashboard>#</a></h2><p>After the first boot I was able to connect to my Duckiebot&rsquo;s dashboard by loading it in my web browser by accessing <code>csc22935.local</code> or the hostname of my Duckiebot. After the initial setup I was able to see the motor commands and camera output on the dashboard as shown below.</p><p><img src=https://user-images.githubusercontent.com/25281309/213753468-49cb40f8-4640-4e86-8d48-ab5757ff36db.png alt="Duckiebot Dashboard"></p><h2 id=getting-the-robot-to-move-and-debugging-pain>Getting the robot to move and debugging pain<a class=anchor aria-hidden=true href=#getting-the-robot-to-move-and-debugging-pain>#</a></h2><p>At first the robot didn&rsquo;t move using <code>dts duckiebot keyboard_control</code>.
I followed the debugging steps, checking to see if the <code>duckiebot-interface</code> is up and running. Then when that didn&rsquo;t resolve the problem I updated the containers which lead to other issues due to what I initially thought my docker package being incompatible with this version of <code>dts</code>. So I uninstalled everything and reflashed the SD card again to double check nothing when wrong during installation, same issue. Then I tried to update the Duckiebot firmware by using <code>dts duckiebot update</code> which lead to another issue this time an 500 server error that I originally thought was caused by docker installation as well.</p><p>Well after many hours spent debugging the issues, doing multiple SD card reflashes and software reinstallations, I found that the problems were not from a single core issue but from multiple, seemly independent sources, here is a list to keep things brief:</p><ul><li>500 Server Error: Removed my DockerHub credentials from the <code>dts</code> config file as that was interfering with the login process that was giving the 500 server error.</li><li>Never apt-get upgrade on the Duckiebot itself as it will brink the entire system, use the <code>dts duckiebot upgrade</code> command instead</li><li>The HUT needed to be reflashed again as it was running the wrong version but was reporting the latest version on the dashboard, thus wasn&rsquo;t a clue at first.</li><li>If the WiFi disconnects it&rsquo;s easier to remove the WiFi adapter and plug it back in as the hotplug parameter was set during initialization therefore it will try and reconnect once the adapter is reconnected into the USB port.</li><li>Don&rsquo;t let your battery get too low otherwise it will lead to unexpected behaviors like improper shutdowns and WiFi disconnections.</li><li>Make sure that all your micro USB cables are connected properly so that it can power on properly and prevent unnecessary SD card reflashes.</li></ul><h2 id=calibrating-the-motors>Calibrating the motors<a class=anchor aria-hidden=true href=#calibrating-the-motors>#</a></h2><p>Following the guide on calibrating the motors I drove the robot in a straight line to see the drift. It it drifted left then I would decrease the trim value and if it drifted right I would increase the trim value.
The trim parameter is a ratio of how much one motor should move compare to the other. If <code>trim > 0</code> then the right motor will spin faster compared to the left and vice versa.
The gain parameter is a scalar value applied to both motors on how much to spin based on the commanded signal. There is a careful balancing act between having enough gain that the robot will move when commanded at the lowest speed but lower enough that any errors aren&rsquo;t amplified to be unpredictable.
For both values I used binary search to find a good enough trim value such that the robot would travel straight with at most a 10 cm drift driving 2 meters. The values I settled on for <code>trim = 0.0515</code> and <code>gain = 0.85</code>. The video below shows the straight line performance of the robot using these values.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/_oTIF_Z0tsU style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h2 id=calibrating-the-camera>Calibrating the camera<a class=anchor aria-hidden=true href=#calibrating-the-camera>#</a></h2><p>Calibrating the camera was pretty easy. Following the instructions outlined in the Duckiebot documentation. I was able to calibrate both the intrinsic and extrinsic values of the robot by calling:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>dts duckiebot calibrate_intrinsics csc22935
</code></pre></div><p>and</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>dts duckiebot calibrate_extrinsics csc22935 
</code></pre></div><p>and follow the instructions outlined from the terminal.</p><p>Intrinsic calibration takes into accound the small manufacturing discrepancies the lens and the sensor will have on an image. By moving the camera or bot back and forth, side to side, up and down, rotating off plane, etc I was able to get the calibration software to learn about these discrepances and make adjustments to the raw outputs so they accurately replicate reality.
Extrinsic calibration tries to learn the camera&rsquo;s location in 3-D space, how it&rsquo;s positioned and how it&rsquo;s rotated. This is important for trying to find the lane markings in Duckietown.</p><h2 id=lane-following>Lane following<a class=anchor aria-hidden=true href=#lane-following>#</a></h2><p>Running the lane following demo was fairly easy I made sure that both <code>duckiebot-interface</code> and <code>car-interface</code> was running and start the lane following container by running this command in <code>dts</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>dts duckiebot demo --demo_name lane_following --duckiebot_name csc22935 --package_name duckietown_demos
</code></pre></div><p>Once the container was running I opened the keyboard control for my bot and pressed the <code>a</code> key to start the lane following demo. The video below shows the lane following demo in action:</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/T9IJy8rgorI style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><p>Note: I had to tune the parameters so that I can make the turns in duckietown. I had to increase the <code>k_theta</code> and <code>k_d</code> values a little bit so the robot can turn more aggressively and make the turns without going over the lines.</p><h2 id=colour-detection>Colour Detection<a class=anchor aria-hidden=true href=#colour-detection>#</a></h2><p>This was the most difficult part of the exercise, something I put way too much effort into when we are not going to use this code base for anything as we are going to use ROS to get the images from the camera node, but it was a good exercise nonetheless. I followed the instructions from the basic development guide from Duckietown and found that a lot of the documentation was outdated. Particularly the GStreamer pipeline code was not for the DB21 platform. I found the correct GStreamer pipeline code from the <code>dt-duckiebot-interface</code> repository and used that to open the camera. However, this still lead to an issue initialization the camera in OpenCV. I think the main issue is caused by missing runtime environments that GStreamer requires that isn&rsquo;t being initialized by Dockerfile. I might be able to find the correct initialization procedure in the <code>dt-duckiebot-interface</code> repository but at this point I spent too much time trying to get this minor code to work. So I just ignored it for now.</p></div><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Exercise 1 on twitter" href="https://twitter.com/intent/tweet/?text=Exercise%201&url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f&hashtags=bulding%2cprogramming%2clinux%2cdocker"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Exercise 1 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f&title=Exercise%201&summary=Exercise%201&source=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Exercise 1 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f&title=Exercise%201"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Exercise 1 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Exercise 1 on whatsapp" href="https://api.whatsapp.com/send?text=Exercise%201%20-%20https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Exercise 1 on telegram" href="https://telegram.me/share/url?text=Exercise%201&url=https%3a%2f%2fquackquack.forkprocess.com%2fblog%2fexercise-1%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></div></div></div></main><footer class=text-center><span>A template by <a href=https://www.heksagon.net title="Your most friendly developer">Heksagon</a> &copy; 2023 Piko</span><div><a href=https://quackquack.forkprocess.com/legal/privacy>Privacy Policy</a>
<span>&</span>
<a href=https://quackquack.forkprocess.com/legal/terms-and-conditions>Terms and Conditions</a></div></footer><article class=hidden id=cookie-banner><div><span>We use cookies to improve your experience on our site and to show you relevant advertising.</span></div><footer><a role=button id=consent-cookies>Close</a>
<a role=button class=secondary href=/legal/privacy/#cookies-and-web-beacons>Cookies Policy</a></footer></article><script async src=https://quackquack.forkprocess.com/js/cookie.min.js layout=container></script>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('kbd');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script><script src=https://quackquack.forkprocess.com/plugins/js/feather.min.js layout=container></script>
<script src=https://quackquack.forkprocess.com/js/script.min.js layout=container></script></body></html>